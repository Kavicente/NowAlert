<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>PNP Analytics - {{ municipality }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/analytics.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="{{ url_for('static', filename='js/analytics.js') }}"></script>
    <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
    <style>
        .week-selector, .date-selector { margin: 10px 0; }
        .week-selector button, .date-selector button { padding: 5px 10px; margin: 5px; }
        .week-selector button.active, .date-selector button.active { background-color: #36A2EB; color: white; }
        .summary-container { float: right; width: 300px; padding: 10px; border: 1px solid #ccc; margin: 10px; }
    </style>
</head>
<body>
    <button class="toggle-btn" onclick="toggleSidebar()">â˜°</button>
    <header class="h1">PNP {{ municipality }} Reports</header>
    <p id="datetime">{{ current_datetime }}</p>
    <!-- Sidebar -->
    <div class="sidebar" id="sidebar">
        <nav>
            <ul>
                <li><a href="{{ url_for('pnp_dashboard') }}">Dashboard</a></li>
                <li><a href="#" onclick="showSection('road')">Road Accident Reports</a></li>
                <li><a href="#" onclick="showSection('crime')">Crime Incident Reports</a></li>
            </ul>
        </nav>
    </div>

    <!-- Main Content -->
    <main class="main-content" id="mainContent">
        <div class="tabs">
            <button class="tab active" onclick="filterData('today')">Today</button>
            <button class="tab" onclick="filterDaily()">Daily</button>
            <button class="tab" onclick="filterWeekly()">Weekly</button>
            <button class="tab" onclick="filterData('monthly')">Monthly</button>
            <button class="tab" onclick="filterData('yearly')">Yearly</button>
        </div>

        <!-- Daily Selector -->
        <div class="date-selector" id="dailySelector" style="display: none;">
            <p>Yesterday: <span id="yesterdayDate"></span></p>
        </div>

        <!-- Weekly Selector -->
        <div class="week-selector" id="weekSelector" style="display: none;">
            <p>Select Week:</p>
            <div id="weekButtons"></div>
            <div id="dateButtons" style="display: none;"></div>
            <div class="summary-container" id="weeklySummary"></div>
        </div>

        <!-- Road Accident Section -->
        <header class="header2" id="letterR" class="section">Road Accident Reports</header>
        <div id="roadSection" class="section">
            <div class="chart-container"><h2>Incident Trends</h2><canvas id="roadIncidentTrendsChart"></canvas></div>
            <div class="chart-container"><h2>Accident Distribution</h2><canvas id="roadAccidentDistributionChart"></canvas></div>
            <div class="chart-container"><h2>Responded Alerts</h2><canvas id="roadRespondedAlertsChart"></canvas></div>
            <div class="chart-container"><h2>Accident Cause</h2><canvas id="roadCauseAnalysisChart"></canvas></div>
            <div class="chart-container"><h2>Accident Type</h2><canvas id="roadAccidentTypeChart"></canvas></div>
            <div class="chart-container"><h2>Road Condition</h2><canvas id="roadConditionChart"></canvas></div>
            <div class="chart-container"><h2>Weather Condition</h2><canvas id="roadWeatherChart"></canvas></div>
            <div class="chart-container"><h2>Vehicle Types</h2><canvas id="roadVehicleTypesChart"></canvas></div>
            <div class="chart-container"><h2>Driver's Age</h2><canvas id="roadDriverAgeChart"></canvas></div>
            <div class="chart-container"><h2>Driver's Gender</h2><canvas id="roadDriverGenderChart"></canvas></div>
        </div>

        <!-- Crime Incident Section -->
        <div id="crimeSection" class="section hidden">
            <header class="header2" id="letterC" class="section hidden">Crime Incident Reports</header>
            <div class="chart-container"><h2>Incident Trends</h2><canvas id="crimeIncidentTrendsChart"></canvas></div>
            <div class="chart-container"><h2>Incident Distribution</h2><canvas id="crimeIncidentDistributionChart"></canvas></div>
            <div class="chart-container"><h2>Responded Alerts</h2><canvas id="crimeRespondedAlertsChart"></canvas></div>
            <div class="chart-container"><h2>Crime Type Analysis</h2><canvas id="crimeTypeAnalysisChart"></canvas></div>
        </div>
    </main>

    <script>
        let charts = {};
        const socket = io('https://alert-858l.onrender.com');

        socket.on('connect', () => {
            socket.emit('register_role', {
                role: 'pnp',
                municipality: '{{ municipality | lower }}'
            });
        });

        socket.on('update_response', (data) => {
            if (document.querySelector('.tab.active').textContent.toLowerCase() === 'today') {
                filterData('today');
            }
        });

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('mainContent');
            sidebar.classList.toggle('active');
            mainContent.classList.toggle('shifted');
        }

        function showSection(type) {
            const roadHeader = document.getElementById('letterR');
            const roadSection = document.getElementById('roadSection');
            const crimeHeader = document.getElementById('letterC');
            const crimeSection = document.getElementById('crimeSection');

            if (type === 'road') {
                roadHeader.classList.remove('hidden');
                roadSection.classList.remove('hidden');
                crimeHeader.classList.add('hidden');
                crimeSection.classList.add('hidden');
            } else if (type === 'crime') {
                roadHeader.classList.add('hidden');
                roadSection.classList.add('hidden');
                crimeHeader.classList.remove('hidden');
                crimeSection.classList.remove('hidden');
            }

            filterData(document.querySelector('.tab.active').textContent.toLowerCase());
        }
    </script>
</body>
</html>